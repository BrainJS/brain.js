{"version":3,"sources":["../../src/utilities/data-formatter.js"],"names":["DataFormatter","values","maxThreshold","undefined","indexTable","characterTable","characters","buildCharactersFromIterable","buildTables","tempCharactersTable","dataFormatterIndex","dataFormatterLength","length","hasOwnProperty","characterIndex","charactersLength","character","push","value","result","i","max","index","Error","value1","value2","toIndexes","split","concat","indices","toCharacters","join","addSpecial","arguments","special","specialIndex","dataFormatterVariableName","toString","replace","toIndexesInputOutput","String","fromCharCode","dataFormatter","fromAllPrintable","addInputOutput","string","prototype","Set","array","filter","v","a","indexOf","sort","json"],"mappings":"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","file":"data-formatter.js","sourcesContent":["/**\r\n *\r\n * @param {String[]|Number[]} values\r\n * @param maxThreshold\r\n * @constructor\r\n */\r\nexport default class DataFormatter {\r\n  constructor(values, maxThreshold = 0) {\r\n    if (values === undefined) return;\r\n\r\n    this.values = values;\r\n    // go over all characters and keep track of all unique ones seen\r\n    // count up all characters\r\n    this.indexTable = {};\r\n    this.characterTable = {};\r\n    this.characters = [];\r\n    this.buildCharactersFromIterable(values);\r\n    this.buildTables(maxThreshold);\r\n  }\r\n\r\n  buildCharactersFromIterable(values) {\r\n    let tempCharactersTable = {};\r\n    for (let dataFormatterIndex = 0, dataFormatterLength = values.length; dataFormatterIndex < dataFormatterLength; dataFormatterIndex++) {\r\n      let characters = values[dataFormatterIndex];\r\n\r\n      if (characters.hasOwnProperty('length')) {\r\n        for (let characterIndex = 0, charactersLength = characters.length; characterIndex < charactersLength; characterIndex++) {\r\n          let character = characters[characterIndex];\r\n          if (tempCharactersTable.hasOwnProperty(character)) continue;\r\n          tempCharactersTable[character] = true;\r\n          this.characters.push(character);\r\n        }\r\n      } else {\r\n        let character = values[dataFormatterIndex];\r\n        if (tempCharactersTable.hasOwnProperty(character)) continue;\r\n        tempCharactersTable[dataFormatterIndex] = true;\r\n        this.characters.push(character);\r\n      }\r\n    }\r\n  }\r\n\r\n  buildTables(maxThreshold) {\r\n    // filter by count threshold and create pointers\r\n    let charactersLength = this.characters.length;\r\n    for(let characterIndex = 0; characterIndex < charactersLength; characterIndex++) {\r\n      let character = this.characters[characterIndex];\r\n      if(characterIndex >= maxThreshold) {\r\n        // add character to dataFormatter\r\n        this.indexTable[character] = characterIndex;\r\n        this.characterTable[characterIndex] = character;\r\n      }\r\n    }\r\n  }\r\n\r\n  toIndexes(value, maxThreshold = 0) {\r\n    let result = [];\r\n    let indexTable = this.indexTable;\r\n\r\n    for (let i = 0, max = value.length; i < max; i++) {\r\n      let character = value[i];\r\n      let index = indexTable[character];\r\n      if (index === undefined) {\r\n        throw new Error(`unrecognized character \"${ character }\"`);\r\n      }\r\n      if (index < maxThreshold) continue;\r\n      result.push(index);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  toIndexesInputOutput(value1, value2 = null, maxThreshold = 0) {\r\n    let result;\r\n    if (typeof value1 === 'string') {\r\n      result = this.toIndexes(value1.split('').concat(['stop-input', 'start-output']), maxThreshold);\r\n    } else {\r\n      result = this.toIndexes(value1.concat(['stop-input', 'start-output']), maxThreshold);\r\n    }\r\n    \r\n    if (value2 === null) return result;\r\n\r\n    if (typeof value2 === 'string') {\r\n      return result.concat(this.toIndexes(value2.split(''), maxThreshold));\r\n    } else {\r\n      return result.concat(this.toIndexes(value2, maxThreshold));\r\n    }\r\n  }\r\n\r\n  toCharacters(indices, maxThreshold = 0) {\r\n    let result = [];\r\n    let characterTable = this.characterTable;\r\n\r\n    for (let i = 0, max = indices.length; i < max; i++) {\r\n      let index = indices[i];\r\n      if (index < maxThreshold) continue;\r\n      let character = characterTable[index];\r\n      if (character === undefined) {\r\n        throw new Error(`unrecognized index \"${ index }\"`);\r\n      }\r\n      result.push(character);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  toString(indices, maxThreshold) {\r\n    return this.toCharacters(indices, maxThreshold).join('');\r\n  }\r\n\r\n  addInputOutput() {\r\n    this.addSpecial('stop-input');\r\n    this.addSpecial('start-output');\r\n  }\r\n\r\n  static fromAllPrintable(maxThreshold, values = ['\\n']) {\r\n    for(let i = 32; i <= 126; i++) {\r\n      values.push(String.fromCharCode(i));\r\n    }\r\n    return new DataFormatter(values, maxThreshold);\r\n  }\r\n\r\n  static fromAllPrintableInputOutput(maxThreshold, values = ['\\n']) {\r\n    const dataFormatter = DataFormatter.fromAllPrintable(maxThreshold, values);\r\n    dataFormatter.addInputOutput();\r\n    return dataFormatter;\r\n  }\r\n\r\n  static fromStringInputOutput(string, maxThreshold) {\r\n    const values = String.prototype.concat(...new Set(string));\r\n    const dataFormatter = new DataFormatter(values, maxThreshold);\r\n    dataFormatter.addInputOutput();\r\n    return dataFormatter;\r\n  }\r\n\r\n  static fromArrayInputOutput(array, maxThreshold) {\r\n    const dataFormatter = new DataFormatter(array.filter((v, i, a) => a.indexOf(v) === i).sort(), maxThreshold);\r\n    dataFormatter.addInputOutput();\r\n    return dataFormatter;\r\n  }\r\n\r\n  static fromString(string, maxThreshold) {\r\n    const values = String.prototype.concat(...new Set(string));\r\n    return new DataFormatter(values, maxThreshold);\r\n  }\r\n\r\n  static fromJSON(json) {\r\n    const dataFormatter = new DataFormatter();\r\n    dataFormatter.indexTable = json.indexTable;\r\n    dataFormatter.characterTable = json.characterTable;\r\n    dataFormatter.values = json.values;\r\n    dataFormatter.characters = json.characters;\r\n    return dataFormatter;\r\n  }\r\n\r\n  addSpecial() {\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      const special = arguments[i];\r\n      let specialIndex = this.indexTable[special] = this.characters.length;\r\n      this.characterTable[specialIndex] = special;\r\n      this.characters.push(special);\r\n    }\r\n  }\r\n\r\n  toFunctionString(dataFormatterVariableName) {\r\n    return `\r\n${ this.toIndexes.toString().replace('this', dataFormatterVariableName) }\r\n${ this.toIndexesInputOutput.toString().replace('this', dataFormatterVariableName) }\r\n${ this.toCharacters.toString().replace('this', dataFormatterVariableName) }\r\n`;\r\n  }\r\n}\r\n"]}